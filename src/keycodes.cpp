#include "keycodes.h"

/* 
Key tables have had matrix index in unsigned integer
0xXY where X - is column^ Y is row in Retro PC keyboard matrix
Tables use scancode offset constant: Index = Scan code & 0xff minus table offset
 */
uint8_t table1_offset = 0x10;
bool radio86rk_ru_mode = false;

uint8_t radio86rk_ru[] ={
/* 0x10 */  0xff, 0xff, 0xff, 0xff, 0xff, 0x52, 0x21, 0xff, 
/* 0x18 */  0xff, 0xff, 0x61, 0x71, 0x46, 0x43, 0x22, 0xff, 
/* 0x20 */  0xff, 0x63, 0x76, 0x67, 0x65, 0x24, 0x23, 0xff, 
/* 0x28 */  0xff, 0x77, 0x55, 0x41, 0x45, 0x53, 0x25, 0xff, 
/* 0x30 */  0xff, 0x64, 0x51, 0x62, 0x60, 0x56, 0x26, 0xff, 
/* 0x38 */  0xff, 0xff, 0x70, 0x57, 0x47, 0x27, 0x30, 0xff, 
/* 0x40 */  0xff, 0x42, 0x54, 0x73, 0x75, 0x20, 0x31, 0xff, 
/* 0x48 */  0xff, 0x40, 0x37, 0x44, 0x66, 0x72, 0x33, 0xff, 
/* 0x50 */  0xff, 0xff, 0x74, 0xff, 0x50, 0x35, 0xff, 0xff, 
/* 0x58 */  0xff, 0xff, 0x12, 0x70, 0xff, 0x32, 0xff, 0xff
};

uint8_t radio86rk_en[] ={
/* 0x10 */  0xff, 0xff, 0xff, 0xff, 0xff, 0x61, 0x21, 0xff, 
/* 0x18 */  0xff, 0xff, 0x72, 0x63, 0x41, 0x67, 0x22, 0xff, 
/* 0x20 */  0xff, 0x43, 0x70, 0x44, 0x45, 0x24, 0x23, 0xff, 
/* 0x28 */  0xff, 0x77, 0x66, 0x46, 0x64, 0x62, 0x25, 0xff, 
/* 0x30 */  0xff, 0x56, 0x42, 0x50, 0x47, 0x71, 0x26, 0xff, 
/* 0x38 */  0xff, 0xff, 0x55, 0x52, 0x65, 0x27, 0x30, 0xff, 
/* 0x40 */  0xff, 0x34, 0x53, 0x51, 0x57, 0x20, 0x31, 0xff, 
/* 0x48 */  0xff, 0x36, 0x37, 0x54, 0x32, 0x60, 0x33, 0xff, 
/* 0x50 */  0xff, 0xff, 0x22, 0xff, 0x73, 0x35, 0xff, 0xff, 
/* 0x58 */  0xff, 0xff, 0x12, 0x75, 0xff, 0x74, 0xff, 0xff
};

/* Format: key, scan */
/* Format: key, scan, ... */
// uint8_t radio86rk_sc_ru[] ={
//     0x16b, 0x14, // LEFT
//     0x174, 0x16, // RIGHT
//     0x175, 0x15, // UP
//     0x172, 0x17, // DOWN
//     0x0d,  0x10, // TAB
//     0x66,  0x13, // Back Space
//     0x76,  0xff  // ESC
// };

/* Spetial keys
   Format: key, scan, ... 
*/
uint16_t radio86rk_sc[] ={
    0x16b, 0x14, // LEFT
    0x174, 0x16, // RIGHT
    0x175, 0x15, // UP
    0x172, 0x17, // DOWN
    0x0d,  0x10, // TAB
    0x66,  0x13, // Back Space
    0x76,  0x02  // ESC
};

uint8_t stateKeys[] = {
    0x11,  RADIO_86KR_CC_KEY, // ALT 
    0x14,  RADIO_86KR_UC_KEY, // CONTROL
    0x12,  RADIO_86KR_CC_KEY, // SHIFT
    0x58,  RADIO_86KR_RL_KEY  // CAPS LOCK
};

uint8_t tableExt_offset = 0x20;
uint8_t tableExt[] ={
0
};


uint8_t scanToMatrix( uint16_t scan )
{
    uint8_t key = scan & 0xff;

    if ( key >= 0x10 && key < 0x60 ) {
        key -= 0x10;
        if ( radio86rk_ru_mode ) {
            return radio86rk_ru[ key ];
        } else {
            return radio86rk_en[ key ];            
        }
    } else {
        scan &= 0x7ff;
        for ( uint8_t i = 0; i< sizeof( radio86rk_sc ); i+= 2 ) {
            if ( radio86rk_sc[i] == scan ) return radio86rk_sc[i + 1] & 0xff;
        }        
    }
    return 0xFF;
}

uint8_t stateKey( uint16_t scan)
{
    uint8_t key = scan & 0xff;

    for ( uint8_t i = 0; i< sizeof( stateKeys ); i+= 2 ) {
        if ( stateKeys[i] == key ) return stateKeys[i + 1];
    }
    return 0xFF;
}
